C 
C       NODCPUNCH 15 NOVEMBER 1979
C
C
C       THIS IS THE SECOND IN A SERIES OF THREE PROGRAMS WHICH WILL READ
C       SELECTED STATIONS FROM NODC TAPES(NODCRD MOD 3), PUNCH DATA CARDS
C       (NODCPUNCH), AND PLOT CROSS SECTIONS OF TEMPERATURE, SALINITY,
C       AND SIGMA-T(     ).
C
C
C       THIS PROGRAM READS SELECTED STATIONS FROM NODC TAPES,PRINTS THE
C       HEADER INFO,PUNCHED PARTIAL HEADER INFO(FOR STATION ID PURPOSES
C       ONLY), AND SELECTED STATION DATA. IF ORIGINAL STATION DATA IS
C       DESIRED SET NNUM=6, IF INTERPOLATED DATA IS DESIRED SET NNUM=3.
C
C       STATIONS ARE SELECTED AS IN NODCRD MOD 3l
C
C
C         A. BY DIRECT COMPARISON OF ONE FIELD(4 CHARACTERS MAX.) WITH
C            A TEST CONSTANT IN A-FORMAT.
C
C        B. SAME AS A. BUT WITH TWO FIELDS.
C
C        C. EITHER OR BOTH FIELDS IN A AND B MAY BE TESTED BY .GE.IX
C          OR .GE.IX.AND.LE.IT TYPE OR CRITERIA IN I-FORMAT.
C
C       CARD INPUT AND INSTRUCTIONS ARE CODED AS FOLLOWS.
C
C       CARD NO.1 : 80 BYTES OF FORMAT FOR READING CARD NO. 2. TYPICALLY
C       FOR ONE A-FORMAT COMPARISON FIELD,ONE BLANK,AND TWO INTEGERS:
C
C              (10A4,4X,I1,4X,I1,1X,LX,A2,2X,A4,I1,IX,I4,I4,I6,5X)
C
C       CARD NO.2. : 40 BYTES OF VARIABLE FORMAT FOR READING THE TEST
C       VARIABLES IA AND IB FROM TAPE. ALWAYS SPECIFY TWO, EVEN THOUGH
C       YOU MAY ONLY USE THE FIRST. IN COLUMN 45 (MD3) PUT A ZERO OR BLANK
C       IF ONE TEST VARIABLE IS TO BE USED: ANY OTHER NUMERAL WILL
C       INDICATE TWO TEST FIELDS. IN COLUMN 50 (MD1) A ZERO OR BLANK INDICATES
C       PURE CHARACTER RECOGNITION, A '1' INDICATES.GE. A SINGLE CONSTANT,
C       A '2' INDICATED .GE. TEST CONSTANT NO. 1,TC1, AND.LE. TC2;
C       TC1 AND TC2 ARE ENTERED IN COLUMNS 52-55 AND (IF APPROPRIATE) 56-59.
C                  THE SECOND GROUP(SINGLE OR DOUBLE) OF TEST CONSTANTS
C       IS CODED SIMILARLY IN COLUMNS 60-69.COLUMN 60 (MD2) IS LIKE 50. TC3
C       AND (IF APPROPRIATE) TC4 ARE ENTERED IN 62-65 AND 66-69 RESPECTIVELY.
C       COLUMNS 70-75 CONTAIN AN INTEGER SPECIFYING THE NUMBER OF RECORDS
C       TO BE SKIPPED BEFORE PROCESSING: IF BLANK,NO SKIPS.
C
C       CARD NO. 3 : 40 BYTES FOR ENTERING A FORMAT FOR WRITING THE TEST
C       CONSTANTS,E.G.:
C
C            (1X,'TC1='A3,', TC2=',A4,', TC3=',I4, TC4=',14)
C
C      NOTE SOME MANIPULATIONS TO RECOVER THE MINUS SIGN IN TEMPERATURE
C      WHICH APPEARS AS AN 11 OR 12 PUNCH IN THE FOURTH DIGIT.
C 
C 
C 
      DIMENSION FMT1(10),FMT2(20),FMT(20),HDR1(19)
      INTEGER CC,YR,DAY,HR,STANO, DPTH,SDTH,TYP,T21,F1,D1,ZE,TC1,TC2,TC3,TC4
      DATA SGN1/' '/,SDN2/'-',F1/ZF0404040/,D1/ZD04040/,
     1ZE/Z50404040/,SV1/'1'/,DOT/'.'/
C
      CALL REREAD
      REWIND 4
      WRITE(6,6)
    6 FORMAT(///)
C      N IS THE NUMBER OF HEADERS PRINTED,NN IS THE NUMBER OF HEADERS READ,
C      NPG IS THE COUNT OF NUMBER OF LINES PRINTED ON PAGE,NOPAGE IS THE
C      PAGE NUMBER,NREC IS THE NUMER OF RECORDS READ
      NOPAGE=0
      N=0
      NN=0
      NPG=0
      NRD=0
      NNUM=6
C 
C 
C   READ FORMATS,ETC
C
      READ(5,400)FMT
  400 FORMAT(20A4)
      WRITE(6,401)FMT
  401 FORMAT(1X,'FMT=',20A4)
      READ(6,402)FMT1,MD1,MD2,ND,MD3
  402 FORMAT(1X,'FORMAT FOR READING TEST VARIABLES FROM TAPE,MODE1,MODE2
     1,THE NUMBER OF RECORDS TO BE SKIPPED,AND MODE3 ARE:',/1X,10A4,2I5,
     1I10,I5')
      READ(5,403)FMT2
  403 FORMAT(20A4)
      WRITE(6,FMT2)TC1,TC2,TC3,TC4
C      SKIP DIRECTLY TO PRINTING DATA, IF THERE IS NONE TO BE SKIPPED.
      K=0
      NREC=0
   77 IF(ND.EQ.0)GO TO 99
C
C      READ THE UNWANTED DATA
      K=1
    8 READ(4,9,END=200,ERR=190)
    9 FORMAT(79X,I1)
      IF(K.GE.ND) GO TO 99
      K=K+1
      GO TO 8
C      END OF UNWANTED DATA LOOP
C
   99 NREC=K
C
      NCPAGE=NOPAGE+1
      WRITE(6,50)
   50 FORMAT('1')
      WRITE(6,3) NOPAGE
    3 FORMAT(9X,'SELECTED HEADERS FOR BERING AND/OR CHUKCHI AND/OR BEAUF
     1ORT SEAS   PAGE  ',I3//)
      NPG=NPG+3
C       WRITE THE HEADING FOR THE HEADER RECORD ATA.
    5 WRITE(6,4)
    4 FORMAT(5X,'CTY SHP LAT(N)  LONGITUDE  YR MO DY  STANO          NRE
     1C'/)
C
      K=0
C
C      ----------BEGIN MAIN LOOP----------
C
   11 CONTINUE
C
C      HDR1 AND HDR2 CONTAIN ALL HEADER INFO EXCEPT TYPE WHICH IS THE
C      TEST VARIABLE TYP
C
      NREC=NREC+1
C
C      THE NEXT CARD IS ONLY TO BE USED FOR NPS688 IN THE ATLANTIC
C
      IF(NREC.GE.90865)GO TO 194
      READ(4,110,END=200,ERR=190)HDR1,HDR2,TYP
  110 FORMAT(19A4,A3,I1)
      IF(TYP.NE.1)GO TO 11
      NN=NN+1
      READ(99,FMT1)IA,IB
      CALL TEST(IANS,MD1,MD2,MD3,TC1,TC2,TC3,TC4,IA,IB)
C     A RETURN OF IANS=1 INDICATED TEST SATISFIED
      IF(IANS.NE.1)GO TO 11
      READ(99,10)CC,SH,LATD,LATM,LOND,LONM,LONM1,LONM2,MSQ,YR,MO,DAY,STA
     1NO
   10 FORMAT(3A2,2A3,3A1,A3,3A2,6X,A3)
   12 N=N+1
      NPG=NPG+2
C
C      WE EXAMINE LONM1 WHICH HAS AN OVERPUNCH FOR EAST LONGITUDES,
C      BECOMING D1,D2,ETC. AND DO INSTEAD OF F1,F2,AND F0.
C      WE START BY SUBTRACTING ZF0.  IF THE RESULT IS.GT. ZERO, THE
C      DIGIT HAD NO OVERPUNCH AND WE RECREATE THE DIGIT.  IF THE
C      RESULT IS .LT. ZERO, WE SUPPLY THE MINUS SIGN, FIND OUT IF IT WAS
C      A DIGIT .GT. ZERO BY SIMILAR PROCEDURE, ETC.
C
      NB=LONM1-F1
      IF(NB.GE.0) GO TO 43
C      SIGN MUST BE NEGATIVE.
      SGN=SGN2
C      RECREATE ORIGINAL DIGIT AND SUBTRACT ZD0: THIS ALSO CONVERTS
C      A Z50 INTO A 10000000, A-0.
      NB=NB+F1-D1
      IF(NB.GE.O) GO TO 45
C      RECREATE DIGIT IF IT  WAS NOT AMONG 0 TO 9 AND PRINT IT UNCHANGED.
      NB=NB+D1
      GO TO 47
   43 SGN=SGN1
   45 NB=NB+F1
   47 WRITE(6,20)CC,SH,LATD,LATM,SGN,LOND,LONM,NB   ,LONM2,YR,MO,DAY,STA
     1NO,NREC
   20 FORMAT(/6X,A2,2X,A2,1X,A2,A3,4X,A1,A3,3A1,3X,3(A2,1X),1X,A3,10X,I6
     1)
      WRITE(7,21)CC,SH,LATD,LATM,SGN,LOND,LONM,NB   ,LONM2,YR,MO,DAY,STA
     1NO,NREC
   21 FORMAT(6X,A2,2X,A2,1X,A2,A3,4X,A1,A3,3A1,3X,3(A2,1X),1X,A3,10X,I6)
      WRITE(6,24)
   24 FORMAT(' ')
      NPG=NPG+2
C
   27 NREC=NREC+1
C     READ DATA
      READ(4,30,END=200,ERR=192) D,T1,T2,T21,   T22,S1,S2,ST1,ST2,
     1SV2,SV3,01,02,TYP
   30 FORMAT(T28,A4,1X,A2,3A1,A2,A3,A2,A2,T47,A3,A1,A1,A2,T80,I1)
      IF(TYPE.NE.1)GO TO 31
      NN=NN+1
      IF(NPG.LE.70)GO TO 32
      NOPAGE=NOPAGE+1
      NPG=0
      WRITE(6,50)
      WRITE(6,3)NOPAGE
      WRITE(6,4)
   32 READ(99,FMT1)IA,IB
      CALL TEST(IANS,MD1,MD2,MD3,TC1,TC2,TC3,TC4,IA,IB)
      IF(IANS.NE.1)GO TO 11
      READ(99,10)CC,SH,LATD,LATM,LOND,LONM,LONM1,LONM2,MSQ,YR,MO,DAY,STA
     1NO
      GO TO 12
C      WE EXAMINE T21, WHICH HAS AN OVERPUNCH FOR A MINUS SIGN,
C      BECOMING D1,D2,ETC. AND DO INSTEAD OF F1,F2, AND F0.
C      WE START BY SUBTRACTING ZF0.  IF THE RESULT IS .GT. ZERO, THE
C      DIGIT HAD NO OVERPUNCH AND WE RECREATE THE DIGIT.  IF THE
C      RESULT IS .LT. ZERO, WE SUPPLY THE MINUS SIGN, FIND OUT IF IT WAS
C      A DIGIT .GT. ZERO BY A SIMILAR PROCEDURE, ETC.
   32 IF(TYP.NE.NNUM)GO TO 27
      NB=T21-F1
      IF(NB.GE.0) GO TO 33
C      SIGN MUST BE NEGATIVE.
      SGN=SGN2
C      RECREATE ORIGINAL DIGIT AND SUBTRACT ZD0; THIS ALSO CONVERTS
C      A Z50 INTO A 10000000, A -0.
      NB=NB+F1-D1
      IF(NB.GE.0) GO TO 35
C      RECREATE DIGIT IF IT  WAS NOT AMONG 0 TO 9 AND PRINT IT UNCHANGED.
      NB=NB+D1
      GO TO 37
   33 SGN=SGN1
   35 NB=NB+F1
   37 WRITE(6,95) D,SGN,T1,DOT,T2,NB,T22,S1,DOT,D2,ST1,DOT,ST2,O1,DOT,
     1O2,SV1,SV2,DOT,SV3,TYP
      WRITE(7,95) D,SGN,T1,DOT,T2,NB,T22,D1,DOT,S2,ST1,DOT,ST2,O1,DOT,
     102,SV1,SV2,DOT,SV3,TYP
   95 NPG=NPG+1
      GO TO 27
C      --------END OF DATA-READ LOOP
C
C      ----------END OF MAIN LOOP
C
  190 IF(K.EQ.0) GO TO 192
      WRITE(6,191) K,CC,SH,LATD,LATM,LOND,LONM,ID1,ID2,TYP
  191 FORMAT(//5X,'READ ERROR IN SKIP LOOP; CONTINUE.  K= ',I6/)
      K=K+1
      GO TO 8
  192 WRITE(6,193)NREC
  193 FORMAT(//5X,'READ ERROR IN DATA-READ LOOP; CONTINUE. NREC= ',I6/)
      NREC=NREC+1
      GO TO 27
  194 WRITE(6,195)
  195 FORMAT(//5X,' END OF BERING SEA DATA')
      GO TO 999
  200 WRITE(6,205)
  205 FORMAT(//5X,'END OF FILE')
      GO TO 999
  999 STOP
      END
C
C      SUBROUTINE TEST
C      DOES THE TESTING FOR NODCRD MOD. 3
C
      SUBROUTINE INE TEST(IANS,MD1,MD2,MD3,TC1,TC2,TC3,TC4,IA,IB)
C
C      TEST THE FIRST FIELD
      INTEGER TC1,TC2,TC3,TC4
      IF(MD1-1)20,40,60
   20 IF(IA.EQ.TC1)GO TO 30
      IANS=0
      GO TO 999
   30 IANS=1
      IF(MD3.EQ.0)GO TO 999
      GO TO 100
C
   40 IF(IA.GE.TC1)GO TO 50
      IANS=0
      GO TO 999
C
   50 IANS=1
      IF(MD3.EQ.0)GO TO 999
      GO TO 100
   60 IF(IA.GE.TC1)GO TO 65
      IANS=0
      GO TO 999
   65 IF(IA.LE.TC2)GO TO 70
      IANS=0
      GO TO 999
   70 IANS=1
      IF(MD3.EQ.0)GO TO 999
C
C      MD3.NE.0; TEST A SECOND FIELD
C
  100 IF(MD2-1)120,140,160
  120 IF(IB.EQ.TC2)GO TO 999
      IANS=0
      GO TO 999
  140 IF(IB.GE.TC3)GO TO 999
      IANS=0
      GO TO 999
C
  160 IF(IB.GE.TC3)GO TO 165
      IANS=0
      GO TO 999
  165 IF(IB.LE.TC4)GO TO 999
      IANS=0
  999 RETURN
      END
C
C ****************************************************
C ORIGINAL JCL FOR IBM MAINFRAME:
C //GO.FT04F001 DD UNIT=3400-4,VOL=SER=NPS688,DISP=(OLD,KEEP),
C //  DCB=(DEN=2,RECFM=FB,LRECL=80,BLKSIZE=3200),LABEL=(1,SL,IN),
C //  DSN=S2514.NDC2
C //GO.SYSIN  DD  *
(10A4,4X,I1,4X,I1,1X,I2,2X,I2,2X,I1,1X,A4,A4,I6,5X)
(20X,I2,I2,56X)                             0    0 12                    085682
(1X,'TC1=',I2,',TC2=',I2,',TC3=',A4,',TC4=',A4)
